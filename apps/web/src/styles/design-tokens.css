/* V2 token authority for Nargis.
   Rule: only color tokens vary by theme; geometry/motion/layout remain constant. */
:root {
  /* Core semantic tokens (Ember Dawn default) */
  --bg: #faf8f6;
  --surface: #ffffff;
  --primary: #6b46ff;
  --text: #0b1b2b;
  --muted: #6b7b86;
  --success: #059669;
  --error: #ef4444;
  --focus-ring: rgba(107, 70, 255, 0.28);
  --streaming-buffer-bg: rgba(107, 70, 255, 0.08);

  /* Geometry + layout (theme-invariant) */
  --space-1: 8px;
  --space-2: 16px;
  --space-3: 24px;
  --space-4: 32px;
  --radius-1: 8px;
  --radius-2: 12px;
  --radius-3: 16px;
  --content-max-width: 760px;

  /* Elevation (only two levels) */
  --elevation-1: 0 6px 18px rgba(2, 6, 23, 0.06);
  --elevation-2: 0 18px 40px rgba(2, 6, 23, 0.1);

  /* Motion */
  --motion-micro: 120ms;
  --motion-medium: 180ms;
  --motion-large: 260ms;
  --motion-ease: cubic-bezier(0.2, 0.8, 0.2, 1);

  /* Legacy compatibility aliases */
  --color-bg: var(--bg);
  --color-surface: var(--surface);
  --color-primary: var(--primary);
  --color-text: var(--text);
  --color-muted: var(--muted);
  --color-success: var(--success);
  --color-error: var(--error);
  --color-focus: var(--focus-ring);
  --color-foreground: var(--text);
  --color-card: var(--surface);
  --color-card-foreground: var(--text);
  --color-background: var(--bg);
  --color-muted-foreground: var(--muted);
  --color-info: #2563eb;
  --color-warning: #d97706;
  --color-destructive: var(--error);
  --color-primary-rgb: 107, 70, 255;
  --color-border: #d6dde6;
  --overlay-subtle: rgba(0, 0, 0, 0.04);

  /* Existing component scales preserved */
  --msg-gap: 16px;
  --bubble-pad: 12px;
  --radius-sm: 6px;
  --font-family-sans:
    Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto,
    "Helvetica Neue", Arial;
  --font-size-body: 16px;
  --font-size-assistant: 20px;
  --line-height: 1.5;
  --chrome-opacity: 1;

  /* Keep palette tokens for backward compatibility in HabitModal */
  --palette-1: #3b82f6;
  --palette-2: #10b981;
  --palette-3: #f59e0b;
  --palette-4: #ef4444;
  --palette-5: #8b5cf6;
  --palette-6: #ec4899;
  --palette-7: #06b6d4;
  --palette-8: #f97316;
}

/* Midnight Bloom overrides: colors only */
.dark {
  --bg: #0f172a;
  --surface: #0b1220;
  --primary: #7c5cff;
  --text: #e6eef8;
  --muted: #9fb3c8;
  --success: #22c55e;
  --error: #f87171;
  --focus-ring: rgba(124, 92, 255, 0.28);
  --streaming-buffer-bg: rgba(124, 92, 255, 0.16);

  --color-primary-rgb: 124, 92, 255;
  --color-warning: #fbbf24;
  --color-border: color-mix(in srgb, var(--surface) 88%, var(--text) 12%);
  --overlay-subtle: rgba(255, 255, 255, 0.02);
}

/* Layout helpers */
.app__content {
  max-width: var(--content-max-width);
  margin-left: auto;
  margin-right: auto;
  padding-left: var(--space-3);
  padding-right: var(--space-3);
}

/* Chrome dimming during voice session */
.is-voice-active .app__chrome,
.is-voice-active .app__sidebar {
  opacity: var(--chrome-opacity);
  transition: opacity var(--motion-medium) var(--motion-ease);
}

/* Message bubble basics */
.message {
  display: block;
  margin-bottom: var(--msg-gap);
  padding: 16px;
  border-radius: var(--radius-sm);
  line-height: var(--line-height);
  font-family: var(--font-family-sans);
  font-size: var(--font-size-body);
  color: var(--color-text);
  background: transparent;
  border: 1px solid color-mix(in srgb, var(--color-border) 5%, transparent);
  border: 1px solid
    var(
      --border-structural-color,
      color-mix(in srgb, var(--text, var(--color-foreground)) 6%, transparent)
    );
}

.message--assistant {
  font-size: var(--font-size-body);
  background: transparent;
  border-color: color-mix(in srgb, var(--color-border) 3%, transparent);
  border-color: var(
    --border-structural-color,
    color-mix(in srgb, var(--text, var(--color-foreground)) 3%, transparent)
  );
  box-shadow: none;
}

.message--user {
  background: transparent;
  border-color: color-mix(in srgb, var(--color-border) 5%, transparent);
  border-color: var(
    --border-structural-color,
    color-mix(in srgb, var(--text, var(--color-foreground)) 5%, transparent)
  );
  opacity: 1;
}

/* Streaming partial text (low visual weight) */
.message--streaming .message__partial {
  color: var(--color-muted);
  font-style: italic;
  opacity: 0.9;
  transition:
    opacity var(--motion-micro) var(--motion-ease),
    transform var(--motion-medium) var(--motion-ease);
  transform: translateY(0);
}

/* Final assistant entrance */
.message--final {
  animation: fadeUp var(--motion-medium) var(--motion-ease) both;
}

@keyframes fadeUp {
  from {
    opacity: 0;
    transform: translateY(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Recording button states (visual only) */
.record-btn {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  background: var(--color-primary);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  color: white;
  box-shadow: none;
  transition:
    transform var(--motion-micro) var(--motion-ease),
    opacity var(--motion-micro) var(--motion-ease);
}

.record-btn.rec--recording {
  animation: pulse 1000ms infinite var(--motion-ease);
}

@keyframes pulse {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.06);
    opacity: 0.86;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

.record-btn.rec--processing {
  opacity: 0.6;
}
.record-btn.rec--disabled {
  opacity: 0.5;
  pointer-events: none;
}

/* Utility: reduced motion */
@media (prefers-reduced-motion: reduce) {
  .record-btn.rec--recording {
    animation: none;
  }
  .message--final {
    animation: none;
  }
  .message--streaming .message__partial {
    transition: none;
  }
}
